{% block content %}

<div>
    <h1>CREATE AN ACCOUNT</h1>

    {% if messages %}
        <div>
            {% for message in messages %}
                <div>{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}

    <form id="createAccountForm" method="post" 
          hx-post="{% url 'users:register' %}" 
          hx-target="#main-content">
        {% csrf_token %}

        <div>
            <div>
                {{ form.first_name }}
                {% if form.first_name.errors %}
                    <div>{{ form.first_name.errors }}</div>
                {% endif %}
            </div>
            <div>
                {{ form.last_name }}
                {% if form.last_name.errors %}
                    <div>{{ form.last_name.errors }}</div>
                {% endif %}
            </div>
        </div>

        <div>
            {{ form.email }}
            {% if form.email.errors %}
                <div>{{ form.email.errors }}</div>
            {% endif %}
        </div>

        <div>
            {{ form.password1 }}
            {% if form.password1.errors %}
                <div>{{ form.password1.errors }}</div>
            {% endif %}
        </div>

        <div>
            {{ form.password2 }}
            {% if form.password2.errors %}
                <div>{{ form.password2.errors }}</div>
            {% endif %}
            <div id="passwordError" style="display: none;">Passwords do not match</div>
        </div>

        <div>
            <button type="submit">CREATE AN ACCOUNT</button>
            <a href="{% url 'users:login' %}"
               hx-get="{% url 'users:login' %}"
               hx-target="#main-content"
               hx-push-url="true">LOGIN</a>
        </div>
    </form>
</div>

<script>
    const form = document.getElementById('createAccountForm');
    const passwordInput = document.getElementById('id_password1');
    const confirmPasswordInput = document.getElementById('id_password2');
    const passwordError = document.getElementById('passwordError');

    function validatePasswords() {
        const password = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        if (confirmPassword && password !== confirmPassword) {
            passwordError.style.display = 'block';
            return false;
        } else {
            passwordError.style.display = 'none';
            return true;
        }
    }

    confirmPasswordInput.addEventListener('input', validatePasswords);
    passwordInput.addEventListener('input', () => {
        if (confirmPasswordInput.value) {
            validatePasswords();
        }
    });

    form.addEventListener('submit', function(e) {
        if (!validatePasswords()) {
            e.preventDefault();
        }
    });
</script>

{% endblock %}
